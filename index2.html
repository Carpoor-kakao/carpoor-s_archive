<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ì¹´í‘¸ì–´'s ì•„ì¹´ì´ë¸Œ</title>
  <style>
    :root { --bg:#000; --panel:#0f1630; --text:#e8ecf8; --muted:#9fb2d0; --brand:#6aa1ff; --accent:#7cf7d4; --warn:#ffd166; }
    *{box-sizing:border-box}
    body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial,sans-serif;background:#000;color:var(--text);min-height:100dvh}

    header{position:sticky;top:0;z-index:5;background:rgba(0,0,0,.85);backdrop-filter:blur(10px);border-bottom:1px solid rgba(255,255,255,.08);display:flex;align-items:center;gap:12px}
    header img{height:40px;width:auto;}
    .wrap{max-width:980px;margin:0 auto;padding:16px;flex:1}
    h1{margin:0;font-size:24px;letter-spacing:.2px}
    .subtitle{color:var(--muted);font-size:14px}
    .row{display:flex;gap:12px;align-items:center;flex-wrap:wrap;margin-top:10px}
    .pill{background:rgba(255,255,255,.06);border:1px solid rgba(255,255,255,.08);padding:8px 12px;border-radius:999px;color:var(--text);display:inline-flex;gap:8px;align-items:center}
    .btn{cursor:pointer;border:none;border-radius:12px;padding:10px 14px;background:var(--panel);color:var(--text);border:1px solid rgba(255,255,255,.08)}
    .btn:hover{background:#131b3a}
    .btn.primary{background:linear-gradient(180deg,#6aa1ff,#4f86ff);border-color:#3d6fe3}
    .grid{display:grid;grid-template-columns:1fr;gap:16px;margin-top:16px}
    .card{background:rgba(11,16,32,.6);border:1px solid rgba(255,255,255,.08);border-radius:16px;padding:16px}
    .card h3{margin:0 0 8px 0}
    select, input[type="text"], textarea{background:#0e152f;color:var(--text);border:1px solid rgba(255,255,255,.12);border-radius:10px;padding:10px;min-width:160px}
    table{width:100%;border-collapse:separate;border-spacing:0 8px}
    th{font-size:12px;color:var(--muted);text-align:left;padding:0 12px}
    td{background:rgba(255,255,255,.04);border:1px solid rgba(255,255,255,.08);padding:12px;border-left:0;border-right:0}
    tr td:first-child{border-top-left-radius:10px;border-bottom-left-radius:10px;border-left:1px solid rgba(255,255,255,.08)}
    tr td:last-child{border-top-right-radius:10px;border-bottom-right-radius:10px;border-right:1px solid rgba(255,255,255,.08)}
    .medal{display:inline-block;min-width:26px;text-align:center;border-radius:8px;padding:4px 6px;font-weight:700}
    .gold{background:linear-gradient(180deg,#ffd166,#ffc14d);color:#4a3700}
    .silver{background:linear-gradient(180deg,#e6eef7,#d9e1ee);color:#2e3947}
    .bronze{background:linear-gradient(180deg,#e6b089,#d79562);color:#4a2d15}
    .muted{color:var(--muted)}
    .footer{color:var(--muted);font-size:12px;margin-top:16px}

    /* profile drawer */
    .drawer{position:fixed;right:16px;bottom:16px;max-width:360px;width:calc(100% - 32px);transform:translateY(16px);opacity:0;pointer-events:none;transition:opacity .2s, transform .2s;z-index:20}
    .drawer.show{opacity:1;transform:translateY(0);pointer-events:auto}
    .drawer .card{background:rgba(13,20,43,.92);backdrop-filter:blur(8px)}
    .avatar{width:52px;height:52px;border-radius:12px;background:#18224a;border:1px solid rgba(255,255,255,.1);display:flex;align-items:center;justify-content:center;font-weight:700}

    /* request modal */
    dialog{border:1px solid rgba(255,255,255,.15);border-radius:16px;background:#0d142b;color:var(--text);padding:0}
    .modal-head{display:flex;align-items:center;justify-content:space-between;padding:14px 16px;border-bottom:1px solid rgba(255,255,255,.1)}
    .modal-body{padding:16px}
    .qr-box{display:flex;justify-content:center;padding:16px;border-radius:12px;background:rgba(255,255,255,.04)}
    .copy{display:flex;gap:8px;margin-top:10px}
    .tag{font-size:12px;color:var(--muted);border:1px solid rgba(255,255,255,.15);padding:4px 8px;border-radius:999px}
    .req-item{background:rgba(255,255,255,.05);border:1px solid rgba(255,255,255,.08);border-radius:10px;padding:8px 10px;margin-bottom:8px;font-size:14px}
  </style>
</head>
<body>
  <header>
    <img id="logoImg" src="" alt="logo" style="display:none">
    <div class="wrap">
      <h1>ì¹´í‘¸ì–´'s ì•„ì¹´ì´ë¸Œ</h1>
      <div class="subtitle">ì¹œêµ¬ë“¤ì˜ í‚¤/ëª¸ë¬´ê²Œ ë“± í•­ëª©ë³„ ì •ë³´ë¥¼ ì•„ì¹´ì´ë¸Œí•˜ê³  ë¹„êµí•˜ê¸°</div>
      <div class="row">
        <label class="pill">
          í•­ëª©
          <select id="categorySelect" aria-label="í•­ëª© ì„ íƒ"></select>
        </label>
        <label class="pill">
          ì •ë ¬
          <select id="sortSelect" aria-label="ì •ë ¬ ì„ íƒ">
            <option value="desc">ê°’ í° ìˆœ</option>
            <option value="asc">ê°’ ì‘ì€ ìˆœ</option>
          </select>
        </label>
        <label class="pill">
          ê²€ìƒ‰
          <input type="text" id="searchInput" placeholder="ì´ë¦„ ê²€ìƒ‰" />
        </label>
        <button class="btn" id="copyLinkBtn">ë§í¬ ë³µì‚¬</button>
        <button class="btn primary" id="qrBtn">QR ì½”ë“œ</button>
        <button class="btn" id="reqBtn">ì‹ ê·œ ìš”ì²­</button>
      </div>
    </div>
      </div>
  </header>

  <!-- Admin tools (hidden by default; add ?admin=1 to URL to show) -->
  <div id="adminTools" style="display:none;position:fixed;right:16px;top:72px;z-index:50">
    <div class="card" style="background:rgba(0,0,0,.9)">
      <div style="font-weight:700;margin-bottom:6px">ì†Œìœ ì ì „ìš©</div>
      <input id="logoFile" type="file" accept="image/*">
      <div class="muted" style="font-size:12px;margin-top:6px">ì´ë¯¸ì§€ ì„ íƒ â†’ ì•„ë˜ ë²„íŠ¼ìœ¼ë¡œ <b>ìê¸‰ìì¡± ë‹¨ì¼ íŒŒì¼</b> ìƒì„±</div>
      <button class="btn" id="exportSingle" style="margin-top:8px">ë‹¨ì¼ HTMLë¡œ ì €ì¥</button>
    </div>
  </div>


  <main class="wrap grid">
    <section class="card" id="rankCard">
      <h3 id="catTitle">í•­ëª©</h3>
      <table>
        <thead>
          <tr>
            <th>ìˆœìœ„</th>
            <th>ì´ë¦„</th>
            <th>ê°’</th>
            <th>ì—…ë°ì´íŠ¸</th>
          </tr>
        </thead>
        <tbody id="rankBody"></tbody>
      </table>
      <div class="footer">
        URL ë§¤ê°œë³€ìˆ˜ <code>?cat=ìŠ¬ëŸ¬ê·¸</code> ë¡œ íŠ¹ì • í•­ëª©ì„ ë°”ë¡œ ì—´ ìˆ˜ ìˆì–´ìš”.
        ì˜ˆ: <span class="tag">?cat=height</span>
      </div>
    </section>

    <section class="card" id="reqCard">
      <h3>ìš”ì²­ ëª©ë¡</h3>
      <div id="reqList"></div>
    </section>
  </main>

  <div class="drawer" id="profileDrawer">
    <div class="card">
      <div class="row" style="justify-content:space-between;align-items:flex-start">
        <div style="display:flex;gap:12px;align-items:center">
          <div class="avatar" id="pAvatar">ğŸ‘¤</div>
          <div>
            <div style="font-weight:700" id="pName">ì´ë¦„</div>
            <div class="muted" id="pSubtitle">í”„ë¡œí•„ ì •ë³´ ëŒ€ê¸°ì¤‘</div>
          </div>
        </div>
        <button class="btn" id="pClose">ë‹«ê¸°</button>
      </div>
      <div style="margin-top:12px" id="pBody" class="muted"></div>
    </div>
  </div>

  <!-- ìš”ì²­ ëª¨ë‹¬ -->
  <dialog id="reqModal">
    <div class="modal-head">
      <strong>ì‹ ê·œ ìš”ì²­</strong>
      <button class="btn" id="closeReq">ë‹«ê¸°</button>
    </div>
    <div class="modal-body">
      <textarea id="reqText" rows="4" style="width:100%" placeholder="ìš”ì²­ ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”..."></textarea>
      <button class="btn primary" style="margin-top:10px" id="submitReq">ë“±ë¡</button>
    </div>
  </dialog>

  <dialog id="qrModal">
    <div class="modal-head">
      <strong>QRë¡œ ì ‘ì†í•˜ê¸°</strong>
      <button class="btn" id="closeQr">ë‹«ê¸°</button>
    </div>
    <div class="modal-body">
      <div class="copy">
        <input type="text" id="shareUrl" style="flex:1" readonly>
        <button class="btn" id="copyFromModal">ë³µì‚¬</button>
      </div>
      <div class="qr-box"><div id="qrcode"></div></div>
    </div>
  </dialog>

  <script>
    /**
     * ====== DATA ======
     */
    const DATA = {
      people: ["ë¯¼ìˆ˜", "ì§€ì—°", "ìˆ˜í˜„", "íƒœí˜¸", "ë£¨ì¹´"],
      categories: [
        { id: "height", name: "í‚¤", unit: "cm", scores: {}, updated: {} },
        { id: "weight", name: "ëª¸ë¬´ê²Œ", unit: "kg", scores: {}, updated: {} }
      ],
      profiles: {},
      LOGO_DATA_URL: "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAasAAAGpCAYAAAAz2RlmAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAKCSURBVHhe7cExAQAAAMKg9U9tDQ+gAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" // ì—¬ê¸°ì— dataURLì„ ë„£ìœ¼ë©´ ë¡œê³ ê°€ í•­ìƒ í‘œì‹œë©ë‹ˆë‹¤.
    };

    const REQ_KEY = "req_list";
    let reqs = JSON.parse(localStorage.getItem(REQ_KEY)||"[]");

    const $ = (sel) => document.querySelector(sel);
    const fmtDate = (d) => d || "-";

    const categorySelect = $("#categorySelect");
    const sortSelect = $("#sortSelect");
    const searchInput = $("#searchInput");
    const rankBody = $("#rankBody");
    const catTitle = $("#catTitle");

    const drawer = $("#profileDrawer");
    const pName = $("#pName");
    const pSubtitle = $("#pSubtitle");
    const pBody = $("#pBody");
    const pAvatar = $("#pAvatar");

    function populateCategoryOptions(){
      categorySelect.innerHTML = DATA.categories.map(c=>`<option value="${c.id}">${c.name}${c.unit?` (${c.unit})`:''}</option>`).join("");
    }

    function getCurrentCat(){
      const url = new URL(window.location.href);
      const id = url.searchParams.get("cat") || DATA.categories[0]?.id;
      return DATA.categories.find(c=>c.id===id) || DATA.categories[0];
    }

    function setCatInUrl(id){
      const url = new URL(window.location.href);
      url.searchParams.set("cat", id);
      history.replaceState({}, "", url);
    }

    function render(){
      const cat = getCurrentCat();
      if(!cat) return;
      catTitle.textContent = cat.name + (cat.unit?` (${cat.unit})`:"");
      categorySelect.value = cat.id;

      const rows = DATA.people.map(name=>({
        name,
        value: (cat.scores[name]!==undefined && cat.scores[name]!==null) ? Number(cat.scores[name]) : null,
        updated: cat.updated?.[name] || ""
      }));

      const q = searchInput.value.trim().toLowerCase();
      const filtered = q? rows.filter(r=>r.name.toLowerCase().includes(q)) : rows;

      const dir = sortSelect.value;
      filtered.sort((a,b)=>{
        const av = (a.value==null? Number.NEGATIVE_INFINITY : a.value);
        const bv = (b.value==null? Number.NEGATIVE_INFINITY : b.value);
        const cmp = (dir==="asc"? av-bv : bv-av);
        return cmp!==0? cmp : a.name.localeCompare(b.name);
      });

      rankBody.innerHTML = filtered.map((r, idx)=>{
        const i = idx+1;
        let medal = `<span class="medal">${i}</span>`;
        if(i===1) medal = `<span class="medal gold">1</span>`;
        else if(i===2) medal = `<span class="medal silver">2</span>`;
        else if(i===3) medal = `<span class="medal bronze">3</span>`;
        const valText = (r.value==null? '-' : (Number.isInteger(r.value)? r.value : r.value.toFixed(2)));
        return `<tr>
          <td>${medal}</td>
          <td><button class="btn" data-name="${r.name}" style="padding:6px 10px">${r.name}</button></td>
          <td>${valText}</td>
          <td class="muted">${fmtDate(r.updated)}</td>
        </tr>`
      }).join("");

      rankBody.querySelectorAll('button[data-name]').forEach(btn=>{
        btn.addEventListener('click', ()=> openProfile(btn.dataset.name));
      });

      renderReqs();
    }

    function openProfile(name){
      const prof = DATA.profiles?.[name];
      pName.textContent = name;
      pSubtitle.textContent = prof?.subtitle || 'í”„ë¡œí•„ ì •ë³´ ëŒ€ê¸°ì¤‘';
      pBody.textContent = prof?.bio || '';
      pAvatar.textContent = (name?.[0]||'ğŸ‘¤');
      drawer.classList.add('show');
    }

    document.getElementById('pClose').addEventListener('click', ()=> drawer.classList.remove('show'));

    // ìš”ì²­ ê¸°ëŠ¥
    const reqBtn = document.getElementById('reqBtn');
    const reqModal = document.getElementById('reqModal');
    const closeReq = document.getElementById('closeReq');
    const reqText = document.getElementById('reqText');
    const submitReq = document.getElementById('submitReq');
    const reqList = document.getElementById('reqList');

    reqBtn.addEventListener('click', ()=>{ reqText.value=""; reqModal.showModal(); });
    closeReq.addEventListener('click', ()=> reqModal.close());
    submitReq.addEventListener('click', ()=>{
      const val = reqText.value.trim();
      if(!val) return;
      reqs.unshift({text:val, date:new Date().toLocaleString()});
      localStorage.setItem(REQ_KEY, JSON.stringify(reqs));
      reqModal.close();
      renderReqs();
    });

    function renderReqs(){
      reqList.innerHTML = reqs.map(r=>`<div class="req-item">${r.text}<div class="muted" style="font-size:12px">${r.date}</div></div>`).join("");
    }

    // ë¡œê³  í‘œì‹œ
    const logoEl = document.getElementById('logoImg');
    function applyLogo(){
      if(DATA.LOGO_DATA_URL){ logoEl.src = DATA.LOGO_DATA_URL; logoEl.style.display='block'; }
      else { logoEl.style.display='none'; }
    }
    applyLogo();

    // Admin tools: ?admin=1 ì¼ ë•Œë§Œ í‘œì‹œ, ì„ íƒí•œ ì´ë¯¸ì§€ë¥¼ dataURLë¡œ ë³€í™˜ í›„ ë‹¨ì¼ íŒŒì¼ ì €ì¥
    (function(){
      const url = new URL(location.href);
      if(url.searchParams.get('admin')==='1'){
        document.getElementById('adminTools').style.display='block';
      }
      const logoInput = document.getElementById('logoFile');
      const exportBtn = document.getElementById('exportSingle');
      exportBtn?.addEventListener('click', async ()=>{
        if(!logoInput.files || !logoInput.files[0]){ alert('ë¡œê³  ì´ë¯¸ì§€ë¥¼ ì„ íƒí•˜ì„¸ìš”.'); return; }
        const file = logoInput.files[0];
        const dataUrl = await new Promise((res)=>{ const r=new FileReader(); r.onload=e=>res(e.target.result); r.readAsDataURL(file); });
        // í˜„ì¬ ë¬¸ì„œ HTMLì„ ë¬¸ìì—´ë¡œ ë³µì œ í›„, DATA.LOGO_DATA_URL ê°’ì„ dataUrlë¡œ ëŒ€ì²´
        let html = document.documentElement.outerHTML;
        html = html.replace(/LOGO_DATA_URL: \"[^\"]*\"/, `LOGO_DATA_URL: \"${dataUrl}\"`);
        // ë‹¤ìš´ë¡œë“œ
        const blob = new Blob(["<!DOCTYPE html>
"+html], {type:'text/html'});
        const a = document.createElement('a');
        a.href = URL.createObjectURL(blob);
        a.download = 'kapoor-archive.single.html';
        a.click();
      });
    })();

    // QR ì½”ë“œ & ë³µì‚¬
    const qrBtn = document.getElementById('qrBtn');
    const qrModal = document.getElementById('qrModal');
    const closeQr = document.getElementById('closeQr');
    const qrcodeBox = document.getElementById('qrcode');
    const shareUrl = document.getElementById('shareUrl');
    const copyFromModal = document.getElementById('copyFromModal');
    const copyLinkBtn = document.getElementById('copyLinkBtn');

    function currentUrl(){ return window.location.href; }
    async function copy(text){ try{ await navigator.clipboard.writeText(text); toast('ë³µì‚¬ë¨!'); }catch{ alert('ë³µì‚¬
